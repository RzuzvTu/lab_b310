---
title: 資料庫Lab05

---

# Lab-05_1：圖書館資料庫設計
### 情境：
### 請為圖書館設計資料庫。圖書館需要追蹤書籍、會員以及借閱記錄。

**初始資料：**

* 書籍：ISBN、書名、作者 (可能多位)、出版社名稱、出版社地址、出版年份、書籍類別。
* 會員：會員卡號、會員姓名、會員地址、會員電話、會員Email。
* 借閱：會員卡號、會員姓名、ISBN、書名、借閱日期、應還日期、實際歸還日期。

**1. 識別問題與函數相依性**

* 作者可能會很多位，ISBN、書名等會重複出現多次
* 要刪除作者會把整筆書的資料清空
* 作者名字打錯要更改多筆資料

**2. 正規化設計**

* **1NF 先把資料拆成五張表Member、Book、Author、BookAuthor、BorrowRecord**




| Member | Book | Author  |BookAuthor| BorrowRecord|
| -------| -----| ------- |--------  | -------- |
| 卡號    | ISBN | 作者ID  |ISBN      | 會員卡號   |
| 姓名    | 書名  | 作者名稱 |作者ID    | ISBN      |
| 地址    | 出版社名稱 |        |          | 借閱日期    |
| 電話    | 出版社地址 |        |          | 應還日期    |
| Email  | 出版年份  |       |          | 實際歸還日期 |
|    |  書籍類別  |       |          |   訂單編號|

* **2NF 目前表格已經符合2NF**

* **3NF 把出版社獨立成一個表**

| Member | Book     | Author |BookAuthor| BorrowRecord|Publisher|
| -------| -----    | -------|--------  | --------   |-------   |
| 卡號    | ISBN     | 作者ID  |ISBN      | 會員卡號    | 出版社ID  |
| 姓名    | 書名      | 作者名稱 |作者ID    | ISBN       | 出版社名稱 |
| 地址    | 出版社ID |        |          | 借閱日期    | 出版社地址 |
| 電話    | 出版年份 |        |          | 應還日期    |          |
| Email  | 書籍類別   |        |          | 實際歸還日期 |          |
|||||訂單編號|

---

### 函數相依性列表

* member_id → name, address, phone, email
* isbn → title, publisher_id, publish_year, category
* author_id → author_name
* isbn + author_id → 無其他欄位
* borrow_id → member_id, isbn, borrow_date, due_date, return_dateㄕㄕㄕㄕ
* publisher_id → publisher_name, publisher_address

### ERD

![image](https://hackmd.io/_uploads/S1vM6ZAbgx.png)

# Lab-05_2：線上商店訂單系統
### 情境：
### 一家小型線上商店需要一個系統來管理顧客、產品和訂單。

初步收集的資料可能包含：

* 顧客：顧客ID、顧客姓名、Email、電話號碼、完整送貨地址 (街道、城市、郵遞區號、國家)。
* 產品：產品ID、產品名稱、產品描述、單價、庫存數量、供應商名稱、供應商聯絡方式。
* 訂單：訂單ID、顧客ID、顧客姓名、訂單日期、訂單總金額、產品ID (多個)、產品名稱 (多個)、購買數量 (對應每個產品)、單價 (對應每個產品)。

**1. 扁平化表格的函數相依性**

假設表格為訂單ID
|訂單日期|顧客ID|顧客姓名|Email|電話|街道|城市|郵遞區號|國家|產品ID|產品名稱|產品描述|單價|數量|庫存|供應商名稱|供應商聯絡方式|訂單總金額|
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|

他的函數相依性就會是

* 顧客ID → 顧客姓名, Email, 電話, 街道, 城市, 郵遞區號, 國家
* 產品ID → 產品名稱, 產品描述, 單價, 庫存數量, 供應商名稱, 供應商聯絡方式
* 供應商名稱 → 供應商聯絡方式
* 訂單ID → 顧客ID, 訂單日期, 訂單總金額
* 訂單ID + 產品ID → 購買數量, 當下單價


**2. 正規化**

* **1NF**
    地址欄位要分成：街道、城市、郵遞區號、國家
    將訂單產品資訊移動至獨立明細表
    
* **2NF**
    假設主鍵是(訂單ID + 產品ID)
    * 顧客姓名、Email、地址
    * 產品名稱、描述、原始單價、供應商名稱
    * 訂單日期、訂單總金額
    需要把這些資料分出去，獨立成不同的表格

* **3NF**
    * 供應商資料獨立為一個表
    * 顧客地址只依賴顧客ID
    * 
    
| Customer       | Product        | Supplier       | Order         | OrderItem         |
|----------------|----------------|----------------|----------------|--------------------|
| 顧客ID         | 產品ID         | 供應商ID       | 訂單ID         | 訂單ID             |
| 姓名           | 名稱           | 名稱           | 顧客ID         | 產品ID             |
| Email          | 描述           | 聯絡方式       | 訂單日期       | 購買數量           |
| 電話           | 價格           |                | 總金額         | 單價（下單時）     |
| 街道           | 庫存數量       |                |                |                    |
| 城市           | 供應商ID       |                |                |                    |
| 郵遞區號       |                |                |                |                    |
| 國家           |                |                |                |                    |
    
    
    
    
# Lab-05_3：大學課程註冊系統
### 情境：
### 設計一個大學課程註冊系統的資料庫。系統需管理學生、課程、講師以及學生的選課記錄。

初步收集的資料可能包含：

* 學生：學號、學生姓名、主修科系名稱、主修科系辦公室地點。
* 課程：課程代碼、課程名稱、學分數、開課系所代碼、開課系所名稱。
* 講師：講師編號、講師姓名、講師所屬系所代碼、講師所屬系所名稱、講師辦公室號碼。
* 選課記錄：學號、學生姓名、課程代碼、課程名稱、學期、授課講師編號、授課講師姓名、成績。
假設：

* 一位講師可能教授多門課程，一門課程也可能由多位講師講授 (例如，不同班級或共同授課)。
* 學生選修特定學期的特定課程，由特定講師授課。


**1. 函數相依性分析**

* student_id → student_name, major_dept_id
* major_dept_id → dept_name, dept_office
* course_code → course_name, credit, offering_dept_id
* offering_dept_id → dept_name, dept_office
* instructor_id → instructor_name, dept_id, office_room
* dept_id → dept_name, dept_office
* instructor_id + course_code + semester → NULL（純關聯表）
* student_id + course_code + semester + instructor_id → grade


**2. 正規化至 BCNF**

| Student        | Course         | Department     | Instructor      | CourseOffering         | Teaching                          | Enrollment                             |
|----------------|----------------|----------------|------------------|-------------------------|-------------------------------------|----------------------------------------|
| 學號           | 課程代碼       | 系所代碼       | 講師編號         | 課程代碼               | 講師編號                            | 學號                                   |
| 姓名           | 課程名稱       | 系所名稱       | 姓名             | 學期                   | 課程代碼                            | 課程代碼                               |
| 主修系所代碼   | 學分數         | 系所辦公室地點 | 所屬系所代碼     |                         | 學期                                | 學期                                   |
|                | 開課系所代碼   |                | 辦公室號碼       |                         |                                     | 授課講師編號                           |
|                |                |                |                  |                         |                                     | 成績                                   |

**資料符合BCN，不需退回3NF**

**ERD**

![image](https://hackmd.io/_uploads/BJT1YfR-xe.png)

**設計原則及說明**

**1. 遵循正規化原則**
* 將學生主修系所、課程開課系所、講師所屬系所都抽出成 Department 表，避免重複記錄科系資料。
* 將課程開設（CourseOffering） 與 授課講師（Teaching） 拆開處理，支援一門課由多位講師授課。
* 選課資料使用 Enrollment 表，採用複合主鍵包含：學生、課程、學期、講師，確保每筆修課資料唯一且完整。

**2. 完整關聯性設計**
* 每個外鍵都對應其主表的主鍵，保持資料參照完整性。
* 使用複合鍵或中介表清楚表示多對多關係

**3. 查詢效率兼顧**
* Teaching 與 Enrollment 表結構簡潔，可支援高效 JOIN 查詢（例如：查學生修哪位老師的課、成績、修課學期等）。
* 採用單一事實表（Enrollment）集中紀錄「誰在什麼學期修了哪門課，由哪位講師授課、成績為何」。


